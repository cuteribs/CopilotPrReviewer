{
	"nodes":[
		{"id":"user","type":"text","text":"## ğŸ‘¤ Developer / CI Agent\nRuns CLI with PR URL","x":600,"y":-200,"width":200,"height":80,"color":"5"},
		{"id":"cli","type":"text","text":"## ğŸ–¥ï¸ CLI Entry Point\n**Program.cs**\nParses args (System.CommandLine), builds DI container, invokes ReviewOrchestrator","x":500,"y":0,"width":400,"height":100,"color":"4"},
		{"id":"orchestrator","type":"text","text":"## ğŸ¯ ReviewOrchestrator\nMain workflow coordinator:\n1. Parse URL â†’ 2. Fetch PR â†’ 3. Fetch changes â†’ 4. Batch â†’ 5. Review â†’ 6. Post comments â†’ 7. Summary","x":500,"y":200,"width":400,"height":120,"color":"4"},
		{"id":"ado-client","type":"text","text":"## ğŸ”— AzureDevOpsClient\n- `ParsePrUrl()` â€” regex URL parsing\n- `GetPrDetailsAsync()` â€” fetch PR metadata\n- `FetchPrChangesAsync()` â€” fetch file diffs\n- `PostPrCommentAsync()` â€” post review threads\n- Generates unified diffs via DiffPlex","x":0,"y":400,"width":350,"height":140,"color":"6"},
		{"id":"batch-builder","type":"text","text":"## ğŸ“¦ BatchBuilder\nClassify files by tech stack, filter exclusions, count tokens, pack into batches within token budget","x":450,"y":430,"width":350,"height":120,"color":"1"},
		{"id":"console-reporter","type":"text","text":"## ğŸ“Š ConsoleReporter\nSpectre.Console rich tables & severity breakdown","x":1155,"y":20,"width":250,"height":80,"color":"3"},
		{"id":"ext-ado","type":"text","text":"## â˜ï¸ Azure DevOps REST API\n`dev.azure.com` â€” Git, PR, Threads","x":-250,"y":100,"width":250,"height":70,"color":"5"},
		{"id":"ext-copilot","type":"text","text":"## â˜ï¸ GitHub Copilot API\nvia `GitHub.Copilot.SDK`","x":1420,"y":170,"width":250,"height":70,"color":"5"},
		{"id":"copilot-service","type":"text","text":"## ğŸ¤– CopilotReviewService\n- `ReviewBatchAsync()` â€” build prompt, send to Copilot SDK\n- Streams response via event handler\n- Uses `SendAndWaitAsync()` with timeout\n- Parses response JSON into findings","x":1025,"y":330,"width":380,"height":140,"color":"2"},
		{"id":"finding-parser","type":"text","text":"## ğŸ“„ FindingParser\nExtract JSON array from markdown-wrapped Copilot response","x":1280,"y":630,"width":220,"height":80,"color":"3"},
		{"id":"config-group","type":"text","text":"## âš™ï¸ Configuration\n`AzureDevOpsSettings` Â· `CopilotSettings` Â· `ReviewSettings` â€” bound from appsettings.json / env vars / CLI args","x":175,"y":1080,"width":900,"height":60,"color":"6"},
		{"id":"models-group","type":"text","text":"## ğŸ“ Models\n`PrInfo` Â· `PullRequest` Â· `FilePatch` Â· `ReviewBatch` Â· `ReviewFinding` Â· `ReviewSummary` Â· `TechStack` Â· `Severity` Â· `AuthOptions` Â· `PrThread/PrComment`","x":175,"y":960,"width":900,"height":80,"color":"6"},
		{"id":"authenticator","type":"text","text":"## ğŸ” Auth (Authenticator)\n- **OAuthAuthenticator** â€” MSAL OIDC browser flow\n- **PatAuthenticator** â€” PAT from env/CLI\n- **AuthenticatorFactory** â€” auto-detect strategy","x":-150,"y":710,"width":300,"height":120,"color":"3"},
		{"id":"token-counter","type":"text","text":"## ğŸ”¢ TokenCounter\nSharpToken cl100k_base encoding","x":460,"y":795,"width":220,"height":70,"color":"3"},
		{"id":"guideline-provider","type":"text","text":"## ğŸ“‹ GuidelineProvider\nLoad tech-stack-specific guidelines from embedded resources or external path","x":965,"y":610,"width":250,"height":100,"color":"3"},
		{"id":"exclusion-filter","type":"text","text":"## ğŸš« FileExclusionFilter\nExclude lock files, .min.js, .d.ts, .g.cs, etc.","x":690,"y":690,"width":220,"height":80,"color":"3"},
		{"id":"classifier","type":"text","text":"## ğŸ·ï¸ TechStackClassifier\nExtension â†’ TechStack map\n(.csâ†’Dotnet, .tsxâ†’Frontendâ€¦)","x":280,"y":670,"width":220,"height":80,"color":"3"}
	],
	"edges":[
		{"id":"e1","fromNode":"user","fromSide":"bottom","toNode":"cli","toSide":"top","label":"invokes"},
		{"id":"e2","fromNode":"cli","fromSide":"bottom","toNode":"orchestrator","toSide":"top","label":"RunAsync(prUrl)"},
		{"id":"e3","fromNode":"cli","fromSide":"right","toNode":"console-reporter","toSide":"left","label":"PrintSummary"},
		{"id":"e4","fromNode":"orchestrator","fromSide":"left","toNode":"ado-client","toSide":"top","label":"fetch PR & post comments"},
		{"id":"e5","fromNode":"orchestrator","fromSide":"bottom","toNode":"batch-builder","toSide":"top","label":"CreateBatches"},
		{"id":"e6","fromNode":"orchestrator","fromSide":"right","toNode":"copilot-service","toSide":"top","label":"ReviewBatchAsync (parallel)"},
		{"id":"e7","fromNode":"ado-client","fromSide":"bottom","toNode":"authenticator","toSide":"top","label":"GetAuthOptionsAsync"},
		{"id":"e8","fromNode":"ado-client","fromSide":"left","toNode":"ext-ado","toSide":"right","label":"HTTP REST"},
		{"id":"e9","fromNode":"batch-builder","fromSide":"bottom","toNode":"classifier","toSide":"top","label":"Classify"},
		{"id":"e10","fromNode":"batch-builder","fromSide":"bottom","toNode":"exclusion-filter","toSide":"top","label":"ShouldExclude"},
		{"id":"e11","fromNode":"batch-builder","fromSide":"bottom","toNode":"token-counter","toSide":"top","label":"CountTokens"},
		{"id":"e12","fromNode":"copilot-service","fromSide":"bottom","toNode":"guideline-provider","toSide":"top","label":"GetGuidelines"},
		{"id":"e13","fromNode":"copilot-service","fromSide":"bottom","toNode":"finding-parser","toSide":"top","label":"Parse(response)"},
		{"id":"e14","fromNode":"copilot-service","fromSide":"right","toNode":"ext-copilot","toSide":"left","label":"SendAndWaitAsync"}
	]
}